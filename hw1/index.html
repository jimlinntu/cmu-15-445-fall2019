<!DOCTYPE html>
<html lang="en"
      xmlns:og="https://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    
        <meta name="author" content="Andy Pavlo" />
        <meta name="description" content="Overview The first homework is to construct a set of SQL queries for analysing a dataset that will be provided to you. For this, you will look into IMDB data. This homework is an opportunity to: (1) learn basic and certain advanced SQL features, and (2) get familiar with using a full-featured DBMS, SQLite, that can be useful for you in the future. This is a single-person project that will be completed individually (i.e., no groups). Release Date: Sep 01, 2019 Due Date: Sep 11, 2019 @ 11:59pm Specification The homework contains 10 questions in total and is graded …" />
    
    <meta name="keywords" content="" />
    <!--[if lte IE 8]><script src="../css/ie/html5shiv.js"></script><![endif]-->
    <script src="../js/jquery.min.js"></script>
    <script src="../js/jquery.dropotron.min.js"></script>
    <script src="../js/skel.min.js"></script>
    <script src="../js/skel-layers.min.js"></script>
    <script src="../js/init.js"></script>
    <link rel="stylesheet" href="../css/pygment.css" />
    <noscript>
        <link rel="stylesheet" href="../css/skel.css" />
        <link rel="stylesheet" href="../css/style.css" />
        <link rel="stylesheet" href="../css/style-noscript.css" />
    </noscript>
    <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link  href="//fonts.googleapis.com/css?family=Anonymous+Pro:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css" >
    <!--[if lte IE 8]><link rel="stylesheet" href="/css/ie/v8.css" /><![endif]-->
    <!--[if lte IE 9]><link rel="stylesheet" href="/css/ie/v9.css" /><![endif]-->
    
    
    <meta property="og:site_name" content="CMU 15-445/645" />
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Homework #1 - SQL - CMU 15-445/645 :: Intro to Database Systems (Fall 2019)"/>
    <meta property="og:url" content="../homework1/index.html"/>
    <meta property="article:published_time" content="2019-09-06" />
    <meta property="og:description" content="Overview The first homework is to construct a set of SQL queries for analysing a dataset that will be provided to you. For this, you will look into IMDB data. This homework is an opportunity to: (1) learn basic and certain advanced SQL features, and (2) get familiar with using a full-featured DBMS, SQLite, that can be useful for you in the future. This is a single-person project that will be completed individually (i.e., no groups). Release Date: Sep 01, 2019 Due Date: Sep 11, 2019 @ 11:59pm Specification The homework contains 10 questions in total and is graded …" />
        <meta property="og:image"
              content="https://15445.courses.cs.cmu.edu/fall2019/images/twitter-card.jpg"/>

    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@CMUDB">
        <meta name="twitter:creator" content="@CMUDB">
    <meta name="twitter:domain" content="..">
            <meta property="twitter:image"
                  content="https://15445.courses.cs.cmu.edu/fall2019/images/twitter-card.jpg"/>
    
    
    <link href="https://db.cs.cmu.edu/favicon.png" rel="icon">

    <title>Homework #1 - SQL | CMU 15-445/645 :: Intro to Database Systems (Fall 2019) </title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width">
</head>

<body class=" loading">

    <!-- Header -->
    <header id="header" >
        <h1 class="logo">
            <a href="..">CMU 15-445/645</a>
        </h1>
        <nav id="nav">
            <ul>
                <li ><a href="..">Home</a></li>
                            <li><a href="../assignments.html">Assignments</a>
                            <li><a href="../schedule.html">Schedule</a>
                            <li><a href="../syllabus.html">Syllabus</a>
                <!--
                <li class="submenu">
                    <a href="../">Blog</a>
                    <ul>
                    </ul>
                </li>
                -->
                <li> <a title="Youtube" href="https://www.youtube.com/playlist?list=PLSE8ODhjZXjbohkNBWQs_otTrBTrjyohi" target="_new"><i class="fa fa-youtube"></i> Youtube</a>
                <li> <a title="Piazza" href="https://piazza.com/cmu/fall2019/15445645/" target="_new"><i class="fa fa-comments-o"></i> Piazza</a>
                
                <li><a href="#" class="dropdown-toggle" data-toggle="dropdown"  data-hover="dropdown" data-delay="1000" data-close-others="true"> <i class="fa fa-book"></i> Archives <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    <li><a onclick="javascript:pageTracker._trackPageview('/outgoing/15445.courses.cs.cmu.edu');" href="https://15445.courses.cs.cmu.edu/fall2018/" target="_new">Fall 2018</a></li>
                    <li><a onclick="javascript:pageTracker._trackPageview('/outgoing/15445.courses.cs.cmu.edu');" href="https://15445.courses.cs.cmu.edu/fall2017/" target="_new">Fall 2017</a></li>
                </ul></li>
            </ul>
        </nav>
    </header>

<!-- Main -->
<article id="main">

    <header class="special container">
        <span class="icon fa-database"></span>
        <h2>Homework #1 - SQL</h2>
    </header>

    <section class="wrapper style4 container">
  
        <!-- Content -->
        <div class="content">
            <section>
                <p><h1>Overview</h1>
<p>The first homework is to construct a set of SQL queries for analysing a dataset that will be provided to you. For this, you will look into <a onclick="javascript:pageTracker._trackPageview('/outgoing/www.imdb.com');" href="https://www.imdb.com/interfaces/">IMDB data</a>. This homework is an opportunity to: (1) learn basic and certain advanced SQL features, and (2) get familiar with using a full-featured DBMS, <a onclick="javascript:pageTracker._trackPageview('/outgoing/www.sqlite.org');" href="https://www.sqlite.org">SQLite</a>, that can be useful for you in the future.</p>
<p>This is a single-person project that will be completed individually (i.e., no groups).</p>
<!-- START homework1 -->

<!-- AUTO-GENERATED BY GENERATE-SCHEDULE SCRIPT -->

<!-- ANY MODIFICATIONS WILL BE OVERWRITTEN -->

<ul>
<li><b>Release Date:</b> Sep 01, 2019</li>
<li><b>Due Date:</b> Sep 11, 2019 @ 11:59pm
<!-- END homework1 --></li>
</ul>
<h1>Specification</h1>
<p>The homework contains 10 questions in total and is graded out of 100 points. For each question, you will need to construct a SQL query that fetches the desired data from the SQLite DBMS. It will likely take you approximately 6-8 hours to complete the questions.</p>
<h2>Placeholder Folder</h2>
<p>Create the placeholder submission folder with the empty SQL files that you will use for each question:</p>
<pre>
$ mkdir placeholder
$ cd placeholder
$ touch q1_sample.sql \
        q2_uncommon_type.sql \
        q3_tv_vs_movie.sql \
        q4_old_is_not_gold.sql \
        q5_percentage.sql \
        q6_dubbed_smash.sql \
        q7_imdb_250.sql \
        q8_number_of_actors.sql \
        q9_movie_names.sql \
        q10_genre_counts.sql
</pre>

<p>After filling in the queries, you can compress the folder by running the following command:</p>
<pre>
$ zip -j submission.zip placeholder/*.sql
</pre>

<p>The <code>-j</code> flag lets you compress all the SQL queries in the zip file without path information. The grading scripts will <b><u>not</u></b> work correctly unless you do this.</p>
<h1>Instructions</h1>
<h2>Setting Up SQLite</h2>
<p>You will first need to install SQLite on your development machine.</p>
<h3>Install SQLite3 on Ubuntu Linux</h3>
<p>Install the <code>sqlite3</code> and <code>libsqlite3-dev</code> packages by running the following command;</p>
<pre>
$ sudo apt-get install sqlite3 libsqlite3-dev
</pre>

<h3>Install SQLite3 on Mac OS X</h3>
<p>On Mac OS Leopard or later, you don't have to! It comes pre-installed. You can upgrade it, if you absolutely need to, with <a href="brew.sh">Homebrew</a>.</p>
<h2>Load the Database Dump</h2>
<ol>
<li>
<p>Check if <code>sqlite3</code> is properly working by <a onclick="javascript:pageTracker._trackPageview('/outgoing/sqlite.org');" href="https://sqlite.org/cli.html#getting_started">following this tutorial</a>.</p>
</li>
<li>
<p>Download the <a onclick="javascript:pageTracker._trackPageview('/downloads/../files/imdb-cmudb2019.db.gz');" href="../files/imdb-cmudb2019.db.gz">database dump file</a>: 
<pre>
$ wget <a onclick="javascript:pageTracker._trackPageview('/downloads/../files/imdb-cmudb2019.db.gz');" href="../files/imdb-cmudb2019.db.gz">https://15445.courses.cs.cmu.edu/fall2019/files/imdb-cmudb2019.db.gz</a>
</pre></p>
</li>
</ol>
<p>Check its MD5 checksum to ensure that you have correctly downloaded the file:
<pre>
$ md5 imdb-cmudb2019.db.gz 
MD5 (imdb-cmudb2019.db.gz) = 6443351d4b55eb3c881622bd60a8dc5b
</pre></p>
<ol>
<li>Unzip the database from the provided database dump by running the following commands on your shell. Note that the database file be <b>900MB</b> after you decompress it.</li>
</ol>
<pre>
$ gunzip imdb-cmudb2019.db.gz
$ sqlite3 imdb-cmudb2019.db
</pre>

<p>We have prepared a random sample of the original dataset for this assignment. Although this is not required to complete the assignment, the complete dataset is available by following the steps <a onclick="javascript:pageTracker._trackPageview('/outgoing/pypi.org');" href="https://pypi.org/project/imdb-sqlite/">here</a>.</p>
<ol>
<li>Check the contents of the database by running the <code>.tables</code> command on the <code>sqlite3</code> terminal. You should see <strong>6 tables</strong>, and the output should look like this:</li>
</ol>
<pre>
$ sqlite3 imdb-cmudb2019.db
SQLite version 3.11.0
Enter ".help" for usage hints.
sqlite> .tables
akas      crew      episodes  people    ratings   titles
</pre>

<ol>
<li>Create indices using the following commands in SQLite:</li>
</ol>
<pre>
CREATE INDEX ix_people_name ON people (name);
CREATE INDEX ix_titles_type ON titles (type);
CREATE INDEX ix_titles_primary_title ON titles (primary_title);
CREATE INDEX ix_titles_original_title ON titles (original_title);
CREATE INDEX ix_akas_title_id ON akas (title_id);
CREATE INDEX ix_akas_title ON akas (title);
CREATE INDEX ix_crew_title_id ON crew (title_id);
CREATE INDEX ix_crew_person_id ON crew (person_id);
</pre>

<h2>Check the schema</h2>
<p>Get familiar with the schema (structure) of the tables (what attributes do they contain, what are the primary and foreign keys). Run the <code>.schema $TABLE_NAME</code> command on the <code>sqlite3</code> terminal for each table. The output should look like the example below for each table.</p>
<h3>people</h3>
<p><pre>
sqlite&gt; .schema people
CREATE TABLE people (
  person_id VARCHAR PRIMARY KEY,
  name VARCHAR,
  born INTEGER,
  died INTEGER
);
CREATE INDEX ix_people_name ON people (name);
</pre></p>
<p>Contains details for a person. For example, this is a row from the table:
<pre>
nm0000003|Brigitte Bardot|1934|
</pre>
For us, the important fields are <code>person_id</code> (e.g., "nm0000003"), <code>name</code> (e.g., "Brigitte Bardot"), and the year that the person was <code>born</code> (e.g., "1934").</p>
<h3>titles</h3>
<p><pre>
sqlite&gt; .schema titles
CREATE TABLE titles (
  title_id VARCHAR PRIMARY KEY,
  type VARCHAR,
  primary_title VARCHAR,
  original_title VARCHAR,
  is_adult INTEGER,
  premiered INTEGER,
  ended INTEGER,
  runtime_minutes INTEGER,
  genres VARCHAR
);
CREATE INDEX ix_titles_type ON titles (type);
CREATE INDEX ix_titles_primary_title ON titles (primary_title);
CREATE INDEX ix_titles_original_title ON titles (original_title);
</pre></p>
<p>Contains details for a title. For example, this is a row from the table:
<pre>
tt0081400|movie|Raise the Titanic|Raise the Titanic|0|1980||115|Action,Adventure,Drama
</pre>
For us, the important fields are <code>title_id</code> (e.g., "tt0081400"), <code>type</code> (e.g., "movie"), <code>primary_title</code> (e.g., "Raise the Titanic"), <code>runtime_minutes</code> (e.g., 127) and <code>genres</code> (e.g., "Action,Adventure,Drama").</p>
<h3>akas</h3>
<p><pre>
CREATE TABLE akas (
  title_id VARCHAR, -- REFERENCES titles (title_id),
  title VARCHAR,
  region VARCHAR,
  language VARCHAR,
  types VARCHAR,
  attributes VARCHAR,
  is_original_title INTEGER
);
CREATE INDEX ix_akas_title_id ON akas (title_id);
CREATE INDEX ix_akas_title ON akas (title);
</pre></p>
<p>The table contains the alternate titles for the dubbed movies. Note that <code>title_id</code> in this table corresponds to <code>title_id</code> in <code>titles</code>.</p>
<h3>crew</h3>
<p><pre>
CREATE TABLE crew (
  title_id VARCHAR, -- REFERENCES titles (title_id),
  person_id VARCHAR, -- REFERENCES people (person_id),
  category VARCHAR,
  job VARCHAR
);
CREATE INDEX ix_crew_title_id ON crew (title_id);
CREATE INDEX ix_crew_person_id ON crew (person_id);
</pre></p>
<p>Contains the details of the cast of the title. For example, this is a row from the table:
<pre>
tt0000003|nm5442194|producer|producer
</pre>
For us, the important fields are <code>title_id</code> (e.g., "tt0000003"), <code>person_id</code> (e.g., "nm5442194"), and <code>category</code> (e.g., "producer").</p>
<p>Note that <code>title_id</code> corresponds to <code>title_id</code> in <code>titles</code> and <code>person_id</code> corresponds to <code>person_id</code> in <code>people</code>.</p>
<h3>ratings</h3>
<p><pre>
CREATE TABLE ratings (
  title_id VARCHAR PRIMARY KEY, -- REFERENCES titles (title_id),
  rating FLOAT,
  votes INTEGER
);
</pre>
Contains the ratings for each title. For example, this is a row from the table:
<pre>
tt0000001|5.6|1529
</pre>
For us, the important fields are <code>title_id</code> (e.g., "tt0000001"), <code>rating</code> (the average rating for all votes, e.g., "5.6") and <code>votes</code> (the number of votes for the title, e.g., "1529").</p>
<h3>Sanity Check</h3>
<p>Count the number of rows in the table</p>
<pre>
sqlite> select count(*) from titles;
2294719
</pre>

<h2>Construct the SQL Queries</h2>
<p>Now, it's time to start constructing the SQL queries and put them into the placeholder files.</p>
<div class="question">
    <h3>Q1 [0 points] (q1_sample):</h3> The purpose of this query is to make sure
    that the formatting of your output matches exactly the formatting of our auto-grading script.

    <p><b>Details:</b> List all distinct types of titles ordered by type. 

    <p><b>Answer</b>: Here's the correct SQL query and expected output:

    <pre>sqlite> select distinct(type) from titles order by type;
    movie
    short
    tvEpisode
    tvMiniSeries
    tvMovie
    tvSeries
    tvShort
    tvSpecial
    video
    videoGame</pre>

    You should put this SQL query into the appropriate file (<code>q1_sample.sql</code>) in the submission directory (<code>placeholder</code>).
</div>

<div class="question">
    <h3>Q2 [5 points] (q2_uncommon_type):</h3>
    List the longest title of each type along with the runtime minutes.

    <p><b>Details:</b> Find the titles which are the longest by runtime minutes.  There might be cases where there is a tie for the longest titles - in that case return all of them. Display the types, primary titles and runtime minutes, and order it according to type (ascending) and use primary titles (ascending) as tie-breaker.
</div>

<div class="question">
    <h3>Q3 [5 points] (q3_tv_vs_movie):</h3>
    List all types of titles along with the number of associated titles.

    <p><b>Details:</b> Print type and number of associated titles. For example, <code>tvShort|4075</code>. Sort by number of titles in ascending order.
</div>

<div class="question">
    <h3>Q4 [10 points] (q4_old_is_not_gold):</h3>
    Which decades saw the most number of titles getting premiered? List the number of titles in every decade. Like <code>2010s|2789741</code>.

    <p><b>Details:</b> Print all decades and the number of titles. Print the relevant decade in a fancier format by constructing a string that looks like this: <code>2010s</code>. Sort the decades in decreasing order with respect to the number of titles. Remember to exclude titles which have not been premiered (i.e. where <code>premiered</code> is <code>NULL</code>)

    <p><b>PS:</b> Add this to your watchlist: <a onclick="javascript:pageTracker._trackPageview('/outgoing/www.imdb.com');" href="https://www.imdb.com/title/tt5174640/">100 Years (2115)</a>
</div>

<div class="question">
    <h3>Q5 [10 points] (q5_percentage):</h3>
    List the decades and the percentage of titles which premiered in the corresponding decade. Display like : <code>2010s|45.7042</code>

    <p><b>Details:</b>  The percentage of titles for a decade is the number of titles which premiered that decade divided by the total number of titles. For the total number of titles, count all titles including ones that have not been premiered. Round the percentage to four decimal places using <code>ROUND()</code>.
</div>

<div class="question">
    <h3>Q6 [10 points] (q6_dubbed_smash):</h3>
    List the top 10 dubbed titles with the number of dubs.

    <p><b>Details:</b> Count the number of titles in <code>akas</code> for each title in the <code>titles</code> table, and list only the top ten. Print the primary title and the number of corresponding dubbed movies.
</div>

<div class="question">
    <h3>Q7 [15 points] (q7_imdb_250):</h3>
    List the IMDB Top 250 movies along with its weighted rating.

    <p><b>Details:</b> The weighted rating of a movie is calculated according to the following formula:

    <pre>Weighted rating (WR) = (v/(v+m)) * R + (m/(v+m)) * C</pre>
    <ul>
    <li>- R = average rating for the movie (mean), i.e. ratings.rating</li>
    <li>- v = number of votes for the movie, i.e. ratings.votes</li>
    <li>- m = minimum votes required to be listed in the Top 250 (current 25000)</li>
    <li>- C = weighted average rating of all movies</li>
    </ul>

  Print the movie name along with its weighted rating. For example: <code>The Shawshank Redemption|9.27408375213064</code>.
  </div>

<div class="question">
    <h3>Q8 [15 points] (q8_number_of_actors):</h3>
    List the number of actors / actresses who have appeared in any title with Mark Hamill (born in 1951).

    <p><b>Details:</b> Print only the total number of actors and actresses. The answer should include Mark Hamill himself.
</div>

<div class="question">
    <h3>Q9 [15 points] (q9_movie_names):</h3>
    List the movies in alphabetical order which cast both Mark Hamill (born in 1951) and George Lucas (born in 1944).

    <p><b>Details:</b> Print only the names of the movies in alphabetical order.</p>
</div>

<div class="question">
    <h3>Q10 [15 points] (q10_genre_counts):</h3>
    List all distinct genres and the number of titles associated with them.

    <p><b>Details:</b> The <code>titles</code> table contains the titles with their genres. Each title is associated with zero or more genres stored in the <code>genres</code> column as comma-separated values (like "Documentary,Short"). Count the number of titles associated with each genre, and list the genres and the counts, and order it according to the counts (greatest to least). Don't forget to filter empty genres (where <code>genres</code> is blank).

    <p><b>Hint:</b> You might find <a onclick="javascript:pageTracker._trackPageview('/outgoing/sqlite.org');" href="https://sqlite.org/lang_with.html">CTEs</a> useful.
</div>

<h1>Grading Rubric</h1>
<p>Each submission will be graded based on whether the SQL queries fetch the expected sets of tuples from the database. Note that your SQL queries will be auto-graded by comparing their outputs (i.e. tuple sets) to the correct outputs. For your queries, the <strong>order</strong> of the output columns is important; their names are not.</p>
<h1>Late Policy</h1>
<p>See the <a href="../syllabus.html#late-policy">late policy</a> in the syllabus.</p>
<h1>Submission</h1>
<p><b>You can submit on Gradescope now, but we are currently setting up the autograder. We will post on Piazza when the autograder is up.</b></p>
<p>We use the Autograder from Gradescope for grading in order to provide you with immediate feedback. After completing the homework, you can submit your compressed folder <code>submission.zip</code> (only one file) to Gradescope:</p>
<ul>
<li><a onclick="javascript:pageTracker._trackPageview('/outgoing/www.gradescope.com');" href="https://www.gradescope.com/courses/58985/">https://www.gradescope.com/courses/58985/</a></li>
</ul>
<p><b>Important:</b> Use the Gradescope course code announced on Piazza.</p>
<p>We will be comparing the output files using a function similar to <code>diff</code>. You can submit your answers as many times as you like. </p>
<h1>Collaboration Policy</h1>
<ul>
<li>Every student has to work individually on this assignment.</li>
<li>Students are allowed to discuss high-level details about the project with others.</li>
<li>Students are <strong>not</strong> allowed to copy the contents of a white-board after a group meeting with other students.</li>
<li>Students are <strong>not</strong> allowed to copy the solutions from another colleague.</li>
</ul>
<p class="warning bg-danger">
    <i class="trigger fa fa-exclamation-triangle fa-lg"></i>
    <b>WARNING:</b> All of the code for this project must be your own. You may not copy source code from other students or other sources that you find on the web. Plagiarism <b>will not</b> be tolerated. See CMU's <a onclick="javascript:pageTracker._trackPageview('/outgoing/www.cmu.edu');" href="http://www.cmu.edu/policies/documents/Academic%20Integrity.htm">Policy on Academic Integrity</a> for additional information.
</p></p>
                <div class="published">
                    <time datetime="2019-09-06 21:25:07.638158-04:00"> <B>Last Updated:</B> Sep 06, 2019</time>
                </div>
            </section>
        </div>
    </section>
</article>

<!-- Footer -->
<footer id="footer">

    <ul class="icons">
    </ul>
    
    <span class="copyright">
    <a onclick="javascript:pageTracker._trackPageview('/outgoing/db.cs.cmu.edu');" href="https://db.cs.cmu.edu" title="Carnegie Mellon Database Group" class="image-link"><img src="../images/cmu-db-group.svg" class="cmudb-logo" /></a>
    </span>

</footer>    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4067813-24"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    
    gtag('config', 'UA-4067813-24');
    </script>
    <!-- End Google Analytics Code -->

    <!-- Fix scrolling issues to internal HREFs that get positioned behind navbar -->
    <!-- http://stackoverflow.com/questions/10732690/offsetting-an-html-anchor-to-adjust-for-fixed-header -->
    <script src="../theme/js/href_scroll.js"></script>
    
</body>
</html>